<!DOCTYPE html>
<html>
  <head>
    <title>ABI Encode/Decode</title>
    <meta charset="UTF-8">
    <script src="https://cdn.jsdelivr.net/npm/ruby-3_2-wasm-wasi@2.1.0/dist/browser.script.iife.js"></script>
    <script type="text/ruby" src="https://ipfs.io/ipfs/bafkreicutpljjabczkmprlja3mquomqa2ibsl6tpb7ev4vuhfj5jlom6dm"></script>
    <script type="text/ruby">
    require "js"
    require "json"

    class String
      def binary?
        self.each_char do |char|
          return true if char.ord < 32 || char.ord > 126
        end
        false
      end
    end

    module ABI
      extend AbiCoderRb

      before_encoding lambda { |type, value|
        if type.start_with?("bytes")
          hex_to_bin(value)
        elsif type.start_with?("uint") || type.start_with?("int")
          value.to_i
        elsif type == "string"
          value
        else
          value
        end
      }

      after_decoding lambda { |type, value|
        if type == "address"
          "0x#{value}"
        elsif type.start_with?("bytes")
          "0x#{bin_to_hex(value)}"
        elsif type == "string"
          if value.binary? 
            value.force_encoding("UTF-8")
          end
        else
          value
        end
      }
    end

    document = JS.global[:document]
    btn_encode = document.getElementById "btnEncode"
    btn_encode.addEventListener "click" do
      begin
        type = document.getElementById("type")[:value].to_s.strip
        value = JSON.parse(document.getElementById("value")[:value].to_s)
        puts "type:"
        p type
        puts "value:"
        p value
        result = ABI.encode(type, value)
        document.getElementById("data")[:value] = "0x" + ABI.bin_to_hex(result)
      rescue => e
        JS.global.alert(e.message)
      end
    end

    btn_decode = document.getElementById "btnDecode"
    btn_decode.addEventListener "click" do
      begin
        type = document.getElementById("type")[:value].to_s.strip
        data = document.getElementById("data")[:value].to_s.strip
        result = ABI.decode(type, ABI.hex_to_bin(data))
        document.getElementById("value")[:value] = result.to_json
      rescue => e
        JS.global.alert(e.message)
      end
    end

    </script>

    <style type="text/css">
    * {
    box-sizing: border-box;
    }
    pre {
    white-space: pre-wrap;       /* Since CSS 2.1 */
    white-space: -moz-pre-wrap;  /* Mozilla, since 1999 */
    white-space: -pre-wrap;      /* Opera 4-6 */
    white-space: -o-pre-wrap;    /* Opera 7 */
    word-wrap: break-word;       /* Internet Explorer 5.5+ */
    }
    input, textarea {
    padding: 5px;
    }
    </style>
  </head>
  <body>
    <h1>ABI Encode/Decode</h1>
    <h3>IF NOT WORKING, CHECK IF ALL RESOURCES ARE LOADED. </h3>
    <form style="">
      <p>
      <div>type: </div>

      <input type="text" id="type" name="type" value='(((bool,bool,string,bytes3[],address),int112,string[4],bool,(address,uint32[1],(int88[3][2],string),(string,uint96,((bytes15,address,int192,bool,((string[3])))[4],bytes1,(string,(bytes20,(string,((bool,bool),address,bool,bool,int240),uint32[3],(address,uint248[1]),string)),bool),bytes19,(string[][1])),bool[2],string))))' style="width: 100%"></input>

      </textarea>
      <p>
      <div>decoded value: </div>
      <textarea id="value" name="value" value="" style="width: 100%" rows=16>
[
    [
        [
            true,
            false,
            "Moo Ã©ðŸš€oÃ©   oMooðŸš€ o ðŸš€oðŸš€oðŸš€ðŸš€oðŸš€oÃ©M  MMðŸš€oooMooMM ðŸš€oÃ©  oÃ© Ã©oMo  ooo",
            [
                "0x0f921c",
                "0x1e0e9f",
                "0xd4e216"
            ],
            "0x5f62f0cdda00ca0058c649e24dff47dbdcafc99f"
        ],
        2.298091420557911e+32,
        [
            "Moo Ã©ðŸš€Ã©ðŸš€ðŸš€ðŸš€ðŸš€",
            "Moo Ã©ðŸš€Ã©ðŸš€oðŸš€oM   ðŸš€oooo",
            "Moo Ã©ðŸš€ Ã©Ã© Ã© oMÃ©Ã©Mo Ã©M oðŸš€ooMo MÃ©ooðŸš€  MoÃ©M oðŸš€oM Ã©MMðŸš€ðŸš€ðŸš€o oÃ©oo  o",
            "Moo Ã©ðŸš€  oÃ©ooÃ©Ã©"
        ],
        true,
        [
            "0xe972cf1fd035e5f44c17ba7b2cfe6e7006834c95",
            [
                2722283023
            ],
            [
                [
                    [
                        -1.5370694078997127e+26,
                        -8.494827229876379e+25,
                        -1.2179002006932522e+25
                    ],
                    [
                        -1.1535953389017223e+24,
                        1.060255021077316e+26,
                        -9.262360692210346e+25
                    ]
                ],
                "Moo Ã©ðŸš€ðŸš€ o ðŸš€oÃ© ðŸš€ðŸš€ ðŸš€ Ã©Ã©ooÃ©oÃ©o "
            ],
            [
                "Moo Ã©ðŸš€",
                2.8610939720196726e+28,
                [
                    [
                        [
                            "0xec366485ec6d9c690515f6ffaefb77",
                            "0xc7a6be0463115cf55d197a241696bf0a278668d7",
                            -1.784580040333686e+57,
                            true,
                            [
                                [
                                    [
                                        "Moo Ã©ðŸš€MÃ©o ",
                                        "Moo Ã©ðŸš€MM ",
                                        "Moo Ã©ðŸš€ðŸš€ðŸš€ oÃ©oðŸš€ðŸš€oMoðŸš€MðŸš€ ðŸš€  ðŸš€oMM"
                                    ]
                                ]
                            ]
                        ],
                        [
                            "0x4b20ca764fc89d49984d8828034102",
                            "0x546e3d2ec295f2fdaf00a28579014ea427ad2df6",
                            4.70943194378296e+56,
                            false,
                            [
                                [
                                    [
                                        "Moo Ã©ðŸš€oÃ©oooMooMðŸš€ðŸš€oðŸš€oÃ©oMðŸš€ooðŸš€oMÃ©Ã©ooÃ©oÃ©ðŸš€oo MooMðŸš€",
                                        "Moo Ã©ðŸš€Ã©oMÃ©ðŸš€ ðŸš€ðŸš€oMoÃ©MoMoðŸš€Ã©Ã©ðŸš€Mo Ã©Ã© Ã©MoðŸš€oMMooo Ã©oÃ© MðŸš€Mo",
                                        "Moo Ã©ðŸš€Ã©ðŸš€oM oo ðŸš€ðŸš€   MMMo oðŸš€oMMoMMÃ© ðŸš€ðŸš€ Mo MÃ©ðŸš€o M oMðŸš€o  ðŸš€Ã©ðŸš€"
                                    ]
                                ]
                            ]
                        ],
                        [
                            "0xf61e317938a183234db405af4fe70e",
                            "0x28b50c1856955065fd08d2886826ab420be4777d",
                            2.4398016566373683e+57,
                            true,
                            [
                                [
                                    [
                                        "Moo Ã©ðŸš€oÃ©M oÃ© o oo MMooooMMo Ã©Ã©  Moo MoM",
                                        "Moo Ã©ðŸš€",
                                        "Moo Ã©ðŸš€"
                                    ]
                                ]
                            ]
                        ],
                        [
                            "0x0fa48d7828d6719ff5ec356c9f935a",
                            "0xcc57056eedfdc23fbb21c79d986a90c5f4fb9afa",
                            1.7991550827551647e+57,
                            false,
                            [
                                [
                                    [
                                        "Moo Ã©ðŸš€   ",
                                        "Moo Ã©ðŸš€oðŸš€MoMM ðŸš€  MoÃ©Ã©  oMðŸš€Ã©Ã©o MMoÃ©MðŸš€ oMoÃ© oo",
                                        "Moo Ã©ðŸš€ooMoðŸš€oo o oM oðŸš€oM M  ooMoooo  Ã©ðŸš€ooðŸš€  Ã©oðŸš€MðŸš€"
                                    ]
                                ]
                            ]
                        ]
                    ],
                    "0x56",
                    [
                        "Moo Ã©ðŸš€",
                        [
                            "0x8c49432712f2798ba72867212740aa3801fa7f9c",
                            [
                                "Moo Ã©ðŸš€oÃ©Ã©oooðŸš€o",
                                [
                                    [
                                        false,
                                        true
                                    ],
                                    "0x5f44a768df18779e6f48f2d648a30dd4806d3c2f",
                                    false,
                                    false,
                                    8.318478460645762e+70
                                ],
                                [
                                    2059575334,
                                    39634417,
                                    1311059972
                                ],
                                [
                                    "0xdb0474af174cda27c222d6fa2ca36d58193c5309",
                                    [
                                        2.4723906564162784e+74
                                    ]
                                ],
                                "Moo Ã©ðŸš€MoðŸš€ oMo oðŸš€oMoMMðŸš€oMMðŸš€Ã©M   oo oðŸš€oMoooo ðŸš€ðŸš€ oMÃ©ðŸš€ Ã© o "
                            ]
                        ],
                        false
                    ],
                    "0xfc9665e2aa3c3e5c2ee69f78700e8df696ef72",
                    [
                        [
                            [
                                "Moo Ã©ðŸš€o ooÃ©MMoÃ©MMo MMooðŸš€o Ã©oÃ©ðŸš€o",
                                "Moo Ã©ðŸš€oðŸš€oMMMÃ©  oÃ©oMÃ©ðŸš€MoÃ©Ã©ooM ðŸš€",
                                "Moo Ã©ðŸš€",
                                "Moo Ã©ðŸš€oÃ©ðŸš€oM"
                            ]
                        ]
                    ]
                ],
                [
                    true,
                    true
                ],
                "Moo Ã©ðŸš€ðŸš€ oðŸš€ooM  ðŸš€oMÃ©ðŸš€oMM"
            ]
        ]
    ]
]
      </textarea>
      </p>
      <button type="button" id="btnEncode">encodeâ–¼</button>
      <button type="button" id="btnDecode">decodeâ–²</button>
      <p>
      <div>encoded data: </div>
      <textarea id="data" name="data" value="" style="width: 100%" rows="16">
0x000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000b549962e55fee3e17586ce604c30000000000000000000000000000000000000000000000000000000000000240000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000004200000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001200000000000000000000000005f62f0cdda00ca0058c649e24dff47dbdcafc99f000000000000000000000000000000000000000000000000000000000000005e4d6f6f20c3a9f09f9a806fc3a92020206f4d6f6ff09f9a80206f20f09f9a806ff09f9a806ff09f9a80f09f9a806ff09f9a806fc3a94d20204d4df09f9a806f6f6f4d6f6f4d4d20f09f9a806fc3a920206fc3a920c3a96f4d6f20206f6f6f000000000000000000000000000000000000000000000000000000000000000000030f921c00000000000000000000000000000000000000000000000000000000001e0e9f0000000000000000000000000000000000000000000000000000000000d4e2160000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000001a0000000000000000000000000000000000000000000000000000000000000001c4d6f6f20c3a9f09f9a80c3a9f09f9a80f09f9a80f09f9a80f09f9a800000000000000000000000000000000000000000000000000000000000000000000000224d6f6f20c3a9f09f9a80c3a9f09f9a806ff09f9a806f4d202020f09f9a806f6f6f6f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005d4d6f6f20c3a9f09f9a8020c3a9c3a920c3a9206f4dc3a9c3a94d6f20c3a94d206ff09f9a806f6f4d6f204dc3a96f6ff09f9a8020204d6fc3a94d206ff09f9a806f4d20c3a94d4df09f9a80f09f9a80f09f9a806f206fc3a96f6f20206f00000000000000000000000000000000000000000000000000000000000000000000154d6f6f20c3a9f09f9a8020206fc3a96f6fc3a9c3a90000000000000000000000000000000000000000000000e972cf1fd035e5f44c17ba7b2cfe6e7006834c9500000000000000000000000000000000000000000000000000000000a242be0f000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000001c0ffffffffffffffffffffffffffffffffffffffffff80db4a0b20e3ee19a0885effffffffffffffffffffffffffffffffffffffffffb9bb80ee65b653c62d0549fffffffffffffffffffffffffffffffffffffffffff5ecfefa6fd502ce5a086fffffffffffffffffffffffffffffffffffffffffffff0bb778abaef01fa674c900000000000000000000000000000000000000000057b3c5fc77d4552cef8738ffffffffffffffffffffffffffffffffffffffffffb3623035240092b8ca92b500000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000344d6f6f20c3a9f09f9a80f09f9a80206f20f09f9a806fc3a920f09f9a80f09f9a8020f09f9a8020c3a9c3a96f6fc3a96fc3a96f2000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000005c726a26130f7a1972c92b650000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000001100000000000000000000000000000000000000000000000000000000000000000a4d6f6f20c3a9f09f9a800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a056000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000aa0fc9665e2aa3c3e5c2ee69f78700e8df696ef72000000000000000000000000000000000000000000000000000000000000000000000000000000000000000de0000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000002a000000000000000000000000000000000000000000000000000000000000005600000000000000000000000000000000000000000000000000000000000000780ec366485ec6d9c690515f6ffaefb770000000000000000000000000000000000000000000000000000000000c7a6be0463115cf55d197a241696bf0a278668d7ffffffffffffffffb7381d7223f5f0b4120c12aefae26c68fbea1bf7f2cc37de000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000000f4d6f6f20c3a9f09f9a804dc3a96f200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000d4d6f6f20c3a9f09f9a804d4d200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000394d6f6f20c3a9f09f9a80f09f9a80f09f9a80206fc3a96ff09f9a80f09f9a806f4d6ff09f9a804df09f9a8020f09f9a802020f09f9a806f4d4d000000000000004b20ca764fc89d49984d88280341020000000000000000000000000000000000000000000000000000000000546e3d2ec295f2fdaf00a28579014ea427ad2df600000000000000001334e059b350f5c95319b550d128140e4b2587209345f04d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000160000000000000000000000000000000000000000000000000000000000000004c4d6f6f20c3a9f09f9a806fc3a96f6f6f4d6f6f4df09f9a80f09f9a806ff09f9a806fc3a96f4df09f9a806f6ff09f9a806f4dc3a9c3a96f6fc3a96fc3a9f09f9a806f6f204d6f6f4df09f9a80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000564d6f6f20c3a9f09f9a80c3a96f4dc3a9f09f9a8020f09f9a80f09f9a806f4d6fc3a94d6f4d6ff09f9a80c3a9c3a9f09f9a804d6f20c3a9c3a920c3a94d6ff09f9a806f4d4d6f6f6f20c3a96fc3a9204df09f9a804d6f00000000000000000000000000000000000000000000000000000000000000000000000000000000005e4d6f6f20c3a9f09f9a80c3a9f09f9a806f4d206f6f20f09f9a80f09f9a802020204d4d4d6f206ff09f9a806f4d4d6f4d4dc3a920f09f9a80f09f9a80204d6f204dc3a9f09f9a806f204d206f4df09f9a806f2020f09f9a80c3a9f09f9a800000f61e317938a183234db405af4fe70e000000000000000000000000000000000000000000000000000000000028b50c1856955065fd08d2886826ab420be4777d00000000000000006380b7c479e2d6817be556557e585d9c6304ab117e1d159c000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000002f4d6f6f20c3a9f09f9a806fc3a94d206fc3a9206f206f6f204d4d6f6f6f6f4d4d6f20c3a9c3a920204d6f6f204d6f4d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a4d6f6f20c3a9f09f9a8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a4d6f6f20c3a9f09f9a80000000000000000000000000000000000000000000000fa48d7828d6719ff5ec356c9f935a0000000000000000000000000000000000000000000000000000000000cc57056eedfdc23fbb21c79d986a90c5f4fb9afa000000000000000049600e3692600b258c083335613e222532256b33d1c1aba1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000000d4d6f6f20c3a9f09f9a802020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000414d6f6f20c3a9f09f9a806ff09f9a804d6f4d4d20f09f9a8020204d6fc3a9c3a920206f4df09f9a80c3a9c3a96f204d4d6fc3a94df09f9a80206f4d6fc3a9206f6f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000484d6f6f20c3a9f09f9a806f6f4d6ff09f9a806f6f206f206f4d206ff09f9a806f4d204d20206f6f4d6f6f6f6f2020c3a9f09f9a806f6ff09f9a802020c3a96ff09f9a804df09f9a80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a4d6f6f20c3a9f09f9a80000000000000000000000000000000000000000000008c49432712f2798ba72867212740aa3801fa7f9c000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000001a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000005f44a768df18779e6f48f2d648a30dd4806d3c2f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0d7ec1f5284bfcc834ae5e1635185dac60301a21ab37e55f2953286a60000000000000000000000000000000000000000000000000000000007ac2a02600000000000000000000000000000000000000000000000000000000025cc5f1000000000000000000000000000000000000000000000000000000004e253004000000000000000000000000db0474af174cda27c222d6fa2ca36d58193c5309008beeaea132cc63386b43c8a606c19a55825965283f834d42b1243c43aece5500000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000000174d6f6f20c3a9f09f9a806fc3a9c3a96f6f6ff09f9a806f00000000000000000000000000000000000000000000000000000000000000000000000000000000564d6f6f20c3a9f09f9a804d6ff09f9a80206f4d6f206ff09f9a806f4d6f4d4df09f9a806f4d4df09f9a80c3a94d2020206f6f206ff09f9a806f4d6f6f6f6f20f09f9a80f09f9a80206f4dc3a9f09f9a8020c3a9206f2000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000001400000000000000000000000000000000000000000000000000000000000000180000000000000000000000000000000000000000000000000000000000000002d4d6f6f20c3a9f09f9a806f206f6fc3a94d4d6fc3a94d4d6f204d4d6f6ff09f9a806f20c3a96fc3a9f09f9a806f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000304d6f6f20c3a9f09f9a806ff09f9a806f4d4d4dc3a920206fc3a96f4dc3a9f09f9a804d6fc3a9c3a96f6f4d20f09f9a8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a4d6f6f20c3a9f09f9a800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000134d6f6f20c3a9f09f9a806fc3a9f09f9a806f4d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000284d6f6f20c3a9f09f9a80f09f9a80206ff09f9a806f6f4d2020f09f9a806f4dc3a9f09f9a806f4d4d000000000000000000000000000000000000000000000000      
      </textarea>
      </p>
    </form>

    more examples: <a href="https://github.com/wuminzhe/abi_coder_rb/tree/main/spec" target="_blank">abi_coder_rb</a>
  </body>
</html>
